"use strict";var p=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports);var S=p(l=>{"use strict";var x=l&&l.__extends||function(){var n=function(r,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,u){i.__proto__=u}||function(i,u){for(var t in u)Object.prototype.hasOwnProperty.call(u,t)&&(i[t]=u[t])},n(r,e)};return function(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(r,e);function i(){this.constructor=r}r.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();Object.defineProperty(l,"__esModule",{value:!0});l.createJSONRPCNotification=l.createJSONRPCRequest=l.createJSONRPCSuccessResponse=l.createJSONRPCErrorResponse=l.JSONRPCErrorCode=l.JSONRPCErrorException=l.isJSONRPCResponses=l.isJSONRPCResponse=l.isJSONRPCRequests=l.isJSONRPCRequest=l.isJSONRPCID=l.JSONRPC=void 0;l.JSONRPC="2.0";var L=function(n){return typeof n=="string"||typeof n=="number"||n===null};l.isJSONRPCID=L;var k=function(n){return n.jsonrpc===l.JSONRPC&&n.method!==void 0&&n.result===void 0&&n.error===void 0};l.isJSONRPCRequest=k;var F=function(n){return Array.isArray(n)&&n.every(l.isJSONRPCRequest)};l.isJSONRPCRequests=F;var W=function(n){return n.jsonrpc===l.JSONRPC&&n.id!==void 0&&(n.result!==void 0||n.error!==void 0)};l.isJSONRPCResponse=W;var G=function(n){return Array.isArray(n)&&n.every(l.isJSONRPCResponse)};l.isJSONRPCResponses=G;var w=function(n,r,e){var i={code:n,message:r};return e!=null&&(i.data=e),i},B=function(n){x(r,n);function r(e,i,u){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,r.prototype),t.code=i,t.data=u,t}return r.prototype.toObject=function(){return w(this.code,this.message,this.data)},r}(Error);l.JSONRPCErrorException=B;var z;(function(n){n[n.ParseError=-32700]="ParseError",n[n.InvalidRequest=-32600]="InvalidRequest",n[n.MethodNotFound=-32601]="MethodNotFound",n[n.InvalidParams=-32602]="InvalidParams",n[n.InternalError=-32603]="InternalError"})(z=l.JSONRPCErrorCode||(l.JSONRPCErrorCode={}));var H=function(n,r,e,i){return{jsonrpc:l.JSONRPC,id:n,error:w(r,e,i)}};l.createJSONRPCErrorResponse=H;var K=function(n,r){return{jsonrpc:l.JSONRPC,id:n,result:r??null}};l.createJSONRPCSuccessResponse=K;var Q=function(n,r,e){return{jsonrpc:l.JSONRPC,id:n,method:r,params:e}};l.createJSONRPCRequest=Q;var U=function(n,r){return{jsonrpc:l.JSONRPC,method:n,params:r}};l.createJSONRPCNotification=U});var J=p(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.DefaultErrorCode=void 0;N.DefaultErrorCode=0});var M=p(R=>{"use strict";var b=R&&R.__awaiter||function(n,r,e,i){function u(t){return t instanceof e?t:new e(function(s){s(t)})}return new(e||(e=Promise))(function(t,s){function a(c){try{o(i.next(c))}catch(v){s(v)}}function f(c){try{o(i.throw(c))}catch(v){s(v)}}function o(c){c.done?t(c.value):u(c.value).then(a,f)}o((i=i.apply(n,r||[])).next())})},E=R&&R.__generator||function(n,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},i,u,t,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(o){return function(c){return f([o,c])}}function f(o){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(e=0)),e;)try{if(i=1,u&&(t=o[0]&2?u.return:o[0]?u.throw||((t=u.return)&&t.call(u),0):u.next)&&!(t=t.call(u,o[1])).done)return t;switch(u=0,t&&(o=[o[0]&2,t.value]),o[0]){case 0:case 1:t=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,u=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!t||o[1]>t[0]&&o[1]<t[3])){e.label=o[1];break}if(o[0]===6&&e.label<t[1]){e.label=t[1],t=o;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(o);break}t[2]&&e.ops.pop(),e.trys.pop();continue}o=r.call(n,e)}catch(c){o=[6,c],u=0}finally{i=t=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}};Object.defineProperty(R,"__esModule",{value:!0});R.JSONRPCClient=void 0;var P=S(),m=J(),V=function(){function n(r,e){this._send=r,this.createID=e,this.idToResolveMap=new Map,this.id=0}return n.prototype._createID=function(){return this.createID?this.createID():++this.id},n.prototype.timeout=function(r,e){var i=this;e===void 0&&(e=function(s){return(0,P.createJSONRPCErrorResponse)(s,m.DefaultErrorCode,"Request timeout")});var u=function(s,a){var f=setTimeout(function(){s.forEach(function(o){var c=i.idToResolveMap.get(o);c&&(i.idToResolveMap.delete(o),c(e(o)))})},r);return a().then(function(o){return clearTimeout(f),o},function(o){return clearTimeout(f),Promise.reject(o)})},t=function(s,a){var f=(Array.isArray(s)?s:[s]).map(function(o){return o.id}).filter(g);return u(f,function(){return i.requestAdvanced(s,a)})};return{request:function(s,a,f){var o=i._createID();return u([o],function(){return i.requestWithID(s,a,f,o)})},requestAdvanced:function(s,a){return t(s,a)}}},n.prototype.request=function(r,e,i){return this.requestWithID(r,e,i,this._createID())},n.prototype.requestWithID=function(r,e,i,u){return b(this,void 0,void 0,function(){var t,s;return E(this,function(a){switch(a.label){case 0:return t=(0,P.createJSONRPCRequest)(u,r,e),[4,this.requestAdvanced(t,i)];case 1:return s=a.sent(),s.result!==void 0&&!s.error?[2,s.result]:s.result===void 0&&s.error?[2,Promise.reject(new P.JSONRPCErrorException(s.error.message,s.error.code,s.error.data))]:[2,Promise.reject(new Error("An unexpected error occurred"))]}})})},n.prototype.requestAdvanced=function(r,e){var i=this,u=Array.isArray(r);Array.isArray(r)||(r=[r]);var t=r.filter(function(f){return g(f.id)}),s=t.map(function(f){return new Promise(function(o){return i.idToResolveMap.set(f.id,o)})}),a=Promise.all(s).then(function(f){return u||!f.length?f:f[0]});return this.send(u?r:r[0],e).then(function(){return a},function(f){return t.forEach(function(o){i.receive((0,P.createJSONRPCErrorResponse)(o.id,m.DefaultErrorCode,f&&f.message||"Failed to send a request"))}),a})},n.prototype.notify=function(r,e,i){var u=(0,P.createJSONRPCNotification)(r,e);this.send(u,i).then(void 0,function(){})},n.prototype.send=function(r,e){return b(this,void 0,void 0,function(){return E(this,function(i){return[2,this._send(r,e)]})})},n.prototype.rejectAllPendingRequests=function(r){this.idToResolveMap.forEach(function(e,i){return e((0,P.createJSONRPCErrorResponse)(i,m.DefaultErrorCode,r))}),this.idToResolveMap.clear()},n.prototype.receive=function(r){var e=this;Array.isArray(r)||(r=[r]),r.forEach(function(i){var u=e.idToResolveMap.get(i.id);u&&(e.idToResolveMap.delete(i.id),u(i))})},n}();R.JSONRPCClient=V;var g=function(n){return n!=null}});var q=p(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0})});var I=p(h=>{"use strict";var C=h&&h.__assign||function(){return C=Object.assign||function(n){for(var r,e=1,i=arguments.length;e<i;e++){r=arguments[e];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(n[u]=r[u])}return n},C.apply(this,arguments)},j=h&&h.__awaiter||function(n,r,e,i){function u(t){return t instanceof e?t:new e(function(s){s(t)})}return new(e||(e=Promise))(function(t,s){function a(c){try{o(i.next(c))}catch(v){s(v)}}function f(c){try{o(i.throw(c))}catch(v){s(v)}}function o(c){c.done?t(c.value):u(c.value).then(a,f)}o((i=i.apply(n,r||[])).next())})},D=h&&h.__generator||function(n,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},i,u,t,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(o){return function(c){return f([o,c])}}function f(o){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(e=0)),e;)try{if(i=1,u&&(t=o[0]&2?u.return:o[0]?u.throw||((t=u.return)&&t.call(u),0):u.next)&&!(t=t.call(u,o[1])).done)return t;switch(u=0,t&&(o=[o[0]&2,t.value]),o[0]){case 0:case 1:t=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,u=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!t||o[1]>t[0]&&o[1]<t[3])){e.label=o[1];break}if(o[0]===6&&e.label<t[1]){e.label=t[1],t=o;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(o);break}t[2]&&e.ops.pop(),e.trys.pop();continue}o=r.call(n,e)}catch(c){o=[6,c],u=0}finally{i=t=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},X=h&&h.__spreadArray||function(n,r,e){if(e||arguments.length===2)for(var i=0,u=r.length,t;i<u;i++)(t||!(i in r))&&(t||(t=Array.prototype.slice.call(r,0,i)),t[i]=r[i]);return n.concat(t||Array.prototype.slice.call(r))};Object.defineProperty(h,"__esModule",{value:!0});h.JSONRPCServer=void 0;var d=S(),Y=J(),Z=function(){return(0,d.createJSONRPCErrorResponse)(null,d.JSONRPCErrorCode.ParseError,"Parse error")},$=function(n){return(0,d.createJSONRPCErrorResponse)((0,d.isJSONRPCID)(n.id)?n.id:null,d.JSONRPCErrorCode.InvalidRequest,"Invalid Request")},ee=function(n){return(0,d.createJSONRPCErrorResponse)(n,d.JSONRPCErrorCode.MethodNotFound,"Method not found")},re=function(){function n(r){r===void 0&&(r={});var e;this.mapErrorToJSONRPCErrorResponse=oe,this.nameToMethodDictionary={},this.middleware=null,this.errorListener=(e=r.errorListener)!==null&&e!==void 0?e:console.warn}return n.prototype.hasMethod=function(r){return!!this.nameToMethodDictionary[r]},n.prototype.addMethod=function(r,e){this.addMethodAdvanced(r,this.toJSONRPCMethod(e))},n.prototype.toJSONRPCMethod=function(r){return function(e,i){var u=r(e.params,i);return Promise.resolve(u).then(function(t){return ie(e.id,t)})}},n.prototype.addMethodAdvanced=function(r,e){var i;this.nameToMethodDictionary=C(C({},this.nameToMethodDictionary),(i={},i[r]=e,i))},n.prototype.receiveJSON=function(r,e){var i=this.tryParseRequestJSON(r);return i?this.receive(i,e):Promise.resolve(Z())},n.prototype.tryParseRequestJSON=function(r){try{return JSON.parse(r)}catch{return null}},n.prototype.receive=function(r,e){return Array.isArray(r)?this.receiveMultiple(r,e):this.receiveSingle(r,e)},n.prototype.receiveMultiple=function(r,e){return j(this,void 0,void 0,function(){var i,u=this;return D(this,function(t){switch(t.label){case 0:return[4,Promise.all(r.map(function(s){return u.receiveSingle(s,e)}))];case 1:return i=t.sent().filter(te),i.length===1?[2,i[0]]:i.length?[2,i]:[2,null]}})})},n.prototype.receiveSingle=function(r,e){return j(this,void 0,void 0,function(){var i,u;return D(this,function(t){switch(t.label){case 0:return i=this.nameToMethodDictionary[r.method],(0,d.isJSONRPCRequest)(r)?[3,1]:[2,$(r)];case 1:return[4,this.callMethod(i,r,e)];case 2:return u=t.sent(),[2,ue(r,u)]}})})},n.prototype.applyMiddleware=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];this.middleware?this.middleware=this.combineMiddlewares(X([this.middleware],r,!0)):this.middleware=this.combineMiddlewares(r)},n.prototype.combineMiddlewares=function(r){return r.length?r.reduce(this.middlewareReducer):null},n.prototype.middlewareReducer=function(r,e){return function(i,u,t){return r(function(s,a){return e(i,s,a)},u,t)}},n.prototype.callMethod=function(r,e,i){var u=this,t=function(a,f){return r?r(a,f):a.id!==void 0?Promise.resolve(ee(a.id)):Promise.resolve(null)},s=function(a){return u.errorListener('An unexpected error occurred while executing "'.concat(e.method,'" JSON-RPC method:'),a),Promise.resolve(u.mapErrorToJSONRPCErrorResponseIfNecessary(e.id,a))};try{return(this.middleware||ne)(t,e,i).then(void 0,s)}catch(a){return s(a)}},n.prototype.mapErrorToJSONRPCErrorResponseIfNecessary=function(r,e){return r!==void 0?this.mapErrorToJSONRPCErrorResponse(r,e):null},n}();h.JSONRPCServer=re;var te=function(n){return n!==null},ne=function(n,r,e){return n(r,e)},ie=function(n,r){return n!==void 0?(0,d.createJSONRPCSuccessResponse)(n,r):null},oe=function(n,r){var e,i=(e=r?.message)!==null&&e!==void 0?e:"An unexpected error occurred",u=Y.DefaultErrorCode,t;return r instanceof d.JSONRPCErrorException&&(u=r.code,t=r.data),(0,d.createJSONRPCErrorResponse)(n,u,i,t)},ue=function(n,r){return r||(n.id!==void 0?(0,d.createJSONRPCErrorResponse)(n.id,d.JSONRPCErrorCode.InternalError,"Internal error"):null)}});var T=p(y=>{"use strict";var se=y&&y.__awaiter||function(n,r,e,i){function u(t){return t instanceof e?t:new e(function(s){s(t)})}return new(e||(e=Promise))(function(t,s){function a(c){try{o(i.next(c))}catch(v){s(v)}}function f(c){try{o(i.throw(c))}catch(v){s(v)}}function o(c){c.done?t(c.value):u(c.value).then(a,f)}o((i=i.apply(n,r||[])).next())})},ae=y&&y.__generator||function(n,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},i,u,t,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(o){return function(c){return f([o,c])}}function f(o){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(e=0)),e;)try{if(i=1,u&&(t=o[0]&2?u.return:o[0]?u.throw||((t=u.return)&&t.call(u),0):u.next)&&!(t=t.call(u,o[1])).done)return t;switch(u=0,t&&(o=[o[0]&2,t.value]),o[0]){case 0:case 1:t=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,u=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!t||o[1]>t[0]&&o[1]<t[3])){e.label=o[1];break}if(o[0]===6&&e.label<t[1]){e.label=t[1],t=o;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(o);break}t[2]&&e.ops.pop(),e.trys.pop();continue}o=r.call(n,e)}catch(c){o=[6,c],u=0}finally{i=t=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}};Object.defineProperty(y,"__esModule",{value:!0});y.JSONRPCServerAndClient=void 0;var _=S(),ce=function(){function n(r,e,i){i===void 0&&(i={});var u;this.server=r,this.client=e,this.errorListener=(u=i.errorListener)!==null&&u!==void 0?u:console.warn}return n.prototype.applyServerMiddleware=function(){for(var r,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];(r=this.server).applyMiddleware.apply(r,e)},n.prototype.hasMethod=function(r){return this.server.hasMethod(r)},n.prototype.addMethod=function(r,e){this.server.addMethod(r,e)},n.prototype.addMethodAdvanced=function(r,e){this.server.addMethodAdvanced(r,e)},n.prototype.timeout=function(r){return this.client.timeout(r)},n.prototype.request=function(r,e,i){return this.client.request(r,e,i)},n.prototype.requestAdvanced=function(r,e){return this.client.requestAdvanced(r,e)},n.prototype.notify=function(r,e,i){this.client.notify(r,e,i)},n.prototype.rejectAllPendingRequests=function(r){this.client.rejectAllPendingRequests(r)},n.prototype.receiveAndSend=function(r,e,i){return se(this,void 0,void 0,function(){var u,t;return ae(this,function(s){switch(s.label){case 0:return(0,_.isJSONRPCResponse)(r)||(0,_.isJSONRPCResponses)(r)?(this.client.receive(r),[3,4]):[3,1];case 1:return(0,_.isJSONRPCRequest)(r)||(0,_.isJSONRPCRequests)(r)?[4,this.server.receive(r,e)]:[3,3];case 2:return u=s.sent(),u?[2,this.client.send(u,i)]:[3,4];case 3:return t="Received an invalid JSON-RPC message",this.errorListener(t,r),[2,Promise.reject(new Error(t))];case 4:return[2]}})})},n}();y.JSONRPCServerAndClient=ce});var le=exports&&exports.__createBinding||(Object.create?function(n,r,e,i){i===void 0&&(i=e);var u=Object.getOwnPropertyDescriptor(r,e);(!u||("get"in u?!r.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return r[e]}}),Object.defineProperty(n,i,u)}:function(n,r,e,i){i===void 0&&(i=e),n[i]=r[e]}),O=exports&&exports.__exportStar||function(n,r){for(var e in n)e!=="default"&&!Object.prototype.hasOwnProperty.call(r,e)&&le(r,n,e)};Object.defineProperty(exports,"__esModule",{value:!0});O(M(),exports);O(q(),exports);O(S(),exports);O(I(),exports);O(T(),exports);
