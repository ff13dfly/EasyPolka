"use strict";(()=>{var M=Object.defineProperty;var Tr=Object.getOwnPropertyDescriptor;var wr=Object.getOwnPropertyNames;var Nr=Object.prototype.hasOwnProperty;var S=(n,t)=>()=>(n&&(t=n(n=0)),t);var C=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),P=(n,t)=>{for(var r in t)M(n,r,{get:t[r],enumerable:!0})},Or=(n,t,r,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of wr(t))!Nr.call(n,i)&&i!==r&&M(n,i,{get:()=>t[i],enumerable:!(e=Tr(t,i))||e.enumerable});return n};var E=n=>Or(M({},"__esModule",{value:!0}),n);var J={};P(J,{codeType:()=>rr,errorLevel:()=>Q,formatType:()=>k,keysApp:()=>er,rawType:()=>Y,relatedIndex:()=>nr});var Q,Y,k,rr,er,nr,$=S(()=>{"use strict";Q=(e=>(e.ERROR="error",e.WARN="warning",e.UNEXCEPT="unexcept",e))(Q||{}),Y=(i=>(i.DATA="data",i.APP="app",i.LIB="lib",i.NONE="unknow",i))(Y||{}),k=(u=>(u.JAVASCRIPT="js",u.CSS="css",u.MARKDOWN="md",u.JSON="json",u.MIX="mix",u.NONE="",u))(k||{}),rr=(i=>(i.ASCII="ascii",i.UTF8="utf8",i.HEX="hex",i.NONE="",i))(rr||{}),er=(n=>{})(er||{}),nr=(l=>(l[l.AUTH=0]="AUTH",l[l.HIDE=1]="HIDE",l[l.TRUST=2]="TRUST",l[l.NAME=0]="NAME",l[l.BLOCK=1]="BLOCK",l))(nr||{});});var or={};P(or,{linkCreator:()=>_r,linkDecoder:()=>Cr});var B,G,_r,Cr,ar=S(()=>{"use strict";B={check:!1,utf8:!0,pre:"anchor://"},G={getParams:n=>{let t={},r=n.split("&");for(let e=0;e<r.length;e++){let l=r[e].split("=");if(l.length!==2)return{error:"error parameter"};t[l[0]]=l[1]}return t},combineParams:n=>{if(!n)return"";let t=[];for(var r in n)t.push(`${r}=${n[r]}`);return t.length===0?"":t.join("&")}},_r=(n,t)=>{let r=G.combineParams(t);return Array.isArray(n)?n[1]!==0?`${B.pre}${n[0]}/${n[1]}${r&&"?"+r}`:`${B.pre}${n[0]}${r&&"?"+r}`:`${B.pre}${n}${r&&"?"+r}`},Cr=n=>{let t={location:["",0]},r=n.toLocaleLowerCase(),e=B.pre;if(r.length<=e.length+1)return{error:"invalid string"};if(r.substring(0,e.length)!==e)return{error:"invalid protocol"};let l=r.substring(e.length,r.length),u=l.split("?");if(u.length>2)return{error:"error request, please check anchor name"};if(u.length!==1){let c=G.getParams(u[1]);if(c.error)return c;t.param=G.getParams(u[1])}l=u[0];let h=l.split("/"),a=[];for(let c=0;c<h.length;c++)h[c]!==""&&a.push(h[c]);if(a.length===1)t.location[0]=a[0],t.location[1]=0;else{let c=a.pop(),s=parseInt(c);if(isNaN(s))return{error:"block number error"};t.location[1]=s,t.location[0]=a.join("/")}return t}});var ur=C((Gr,ir)=>{(function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(r,e){return r<<e|r>>>32-e},rotr:function(r,e){return r<<32-e|r>>>e},endian:function(r){if(r.constructor==Number)return t.rotl(r,8)&16711935|t.rotl(r,24)&4278255360;for(var e=0;e<r.length;e++)r[e]=t.endian(r[e]);return r},randomBytes:function(r){for(var e=[];r>0;r--)e.push(Math.floor(Math.random()*256));return e},bytesToWords:function(r){for(var e=[],i=0,l=0;i<r.length;i++,l+=8)e[l>>>5]|=r[i]<<24-l%32;return e},wordsToBytes:function(r){for(var e=[],i=0;i<r.length*32;i+=8)e.push(r[i>>>5]>>>24-i%32&255);return e},bytesToHex:function(r){for(var e=[],i=0;i<r.length;i++)e.push((r[i]>>>4).toString(16)),e.push((r[i]&15).toString(16));return e.join("")},hexToBytes:function(r){for(var e=[],i=0;i<r.length;i+=2)e.push(parseInt(r.substr(i,2),16));return e},bytesToBase64:function(r){for(var e=[],i=0;i<r.length;i+=3)for(var l=r[i]<<16|r[i+1]<<8|r[i+2],u=0;u<4;u++)i*8+u*6<=r.length*8?e.push(n.charAt(l>>>6*(3-u)&63)):e.push("=");return e.join("")},base64ToBytes:function(r){r=r.replace(/[^A-Z0-9+\/]/ig,"");for(var e=[],i=0,l=0;i<r.length;l=++i%4)l!=0&&e.push((n.indexOf(r.charAt(i-1))&Math.pow(2,-2*l+8)-1)<<l*2|n.indexOf(r.charAt(i))>>>6-l*2);return e}};ir.exports=t})()});var V=C((jr,lr)=>{var j={utf8:{stringToBytes:function(n){return j.bin.stringToBytes(unescape(encodeURIComponent(n)))},bytesToString:function(n){return decodeURIComponent(escape(j.bin.bytesToString(n)))}},bin:{stringToBytes:function(n){for(var t=[],r=0;r<n.length;r++)t.push(n.charCodeAt(r)&255);return t},bytesToString:function(n){for(var t=[],r=0;r<n.length;r++)t.push(String.fromCharCode(n[r]));return t.join("")}}};lr.exports=j});var fr=C((Vr,sr)=>{sr.exports=function(n){return n!=null&&(cr(n)||Fr(n)||!!n._isBuffer)};function cr(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function Fr(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&cr(n.slice(0,0))}});var q=C((qr,hr)=>{(function(){var n=ur(),t=V().utf8,r=fr(),e=V().bin,i=function(l,u){l.constructor==String?u&&u.encoding==="binary"?l=e.stringToBytes(l):l=t.stringToBytes(l):r(l)?l=Array.prototype.slice.call(l,0):!Array.isArray(l)&&l.constructor!==Uint8Array&&(l=l.toString());for(var o=n.bytesToWords(l),h=l.length*8,a=1732584193,c=-271733879,s=-1732584194,f=271733878,p=0;p<o.length;p++)o[p]=(o[p]<<8|o[p]>>>24)&16711935|(o[p]<<24|o[p]>>>8)&4278255360;o[h>>>5]|=128<<h%32,o[(h+64>>>9<<4)+14]=h;for(var d=i._ff,x=i._gg,v=i._hh,y=i._ii,p=0;p<o.length;p+=16){var N=a,O=c,w=s,_=f;a=d(a,c,s,f,o[p+0],7,-680876936),f=d(f,a,c,s,o[p+1],12,-389564586),s=d(s,f,a,c,o[p+2],17,606105819),c=d(c,s,f,a,o[p+3],22,-1044525330),a=d(a,c,s,f,o[p+4],7,-176418897),f=d(f,a,c,s,o[p+5],12,1200080426),s=d(s,f,a,c,o[p+6],17,-1473231341),c=d(c,s,f,a,o[p+7],22,-45705983),a=d(a,c,s,f,o[p+8],7,1770035416),f=d(f,a,c,s,o[p+9],12,-1958414417),s=d(s,f,a,c,o[p+10],17,-42063),c=d(c,s,f,a,o[p+11],22,-1990404162),a=d(a,c,s,f,o[p+12],7,1804603682),f=d(f,a,c,s,o[p+13],12,-40341101),s=d(s,f,a,c,o[p+14],17,-1502002290),c=d(c,s,f,a,o[p+15],22,1236535329),a=x(a,c,s,f,o[p+1],5,-165796510),f=x(f,a,c,s,o[p+6],9,-1069501632),s=x(s,f,a,c,o[p+11],14,643717713),c=x(c,s,f,a,o[p+0],20,-373897302),a=x(a,c,s,f,o[p+5],5,-701558691),f=x(f,a,c,s,o[p+10],9,38016083),s=x(s,f,a,c,o[p+15],14,-660478335),c=x(c,s,f,a,o[p+4],20,-405537848),a=x(a,c,s,f,o[p+9],5,568446438),f=x(f,a,c,s,o[p+14],9,-1019803690),s=x(s,f,a,c,o[p+3],14,-187363961),c=x(c,s,f,a,o[p+8],20,1163531501),a=x(a,c,s,f,o[p+13],5,-1444681467),f=x(f,a,c,s,o[p+2],9,-51403784),s=x(s,f,a,c,o[p+7],14,1735328473),c=x(c,s,f,a,o[p+12],20,-1926607734),a=v(a,c,s,f,o[p+5],4,-378558),f=v(f,a,c,s,o[p+8],11,-2022574463),s=v(s,f,a,c,o[p+11],16,1839030562),c=v(c,s,f,a,o[p+14],23,-35309556),a=v(a,c,s,f,o[p+1],4,-1530992060),f=v(f,a,c,s,o[p+4],11,1272893353),s=v(s,f,a,c,o[p+7],16,-155497632),c=v(c,s,f,a,o[p+10],23,-1094730640),a=v(a,c,s,f,o[p+13],4,681279174),f=v(f,a,c,s,o[p+0],11,-358537222),s=v(s,f,a,c,o[p+3],16,-722521979),c=v(c,s,f,a,o[p+6],23,76029189),a=v(a,c,s,f,o[p+9],4,-640364487),f=v(f,a,c,s,o[p+12],11,-421815835),s=v(s,f,a,c,o[p+15],16,530742520),c=v(c,s,f,a,o[p+2],23,-995338651),a=y(a,c,s,f,o[p+0],6,-198630844),f=y(f,a,c,s,o[p+7],10,1126891415),s=y(s,f,a,c,o[p+14],15,-1416354905),c=y(c,s,f,a,o[p+5],21,-57434055),a=y(a,c,s,f,o[p+12],6,1700485571),f=y(f,a,c,s,o[p+3],10,-1894986606),s=y(s,f,a,c,o[p+10],15,-1051523),c=y(c,s,f,a,o[p+1],21,-2054922799),a=y(a,c,s,f,o[p+8],6,1873313359),f=y(f,a,c,s,o[p+15],10,-30611744),s=y(s,f,a,c,o[p+6],15,-1560198380),c=y(c,s,f,a,o[p+13],21,1309151649),a=y(a,c,s,f,o[p+4],6,-145523070),f=y(f,a,c,s,o[p+11],10,-1120210379),s=y(s,f,a,c,o[p+2],15,718787259),c=y(c,s,f,a,o[p+9],21,-343485551),a=a+N>>>0,c=c+O>>>0,s=s+w>>>0,f=f+_>>>0}return n.endian([a,c,s,f])};i._ff=function(l,u,o,h,a,c,s){var f=l+(u&o|~u&h)+(a>>>0)+s;return(f<<c|f>>>32-c)+u},i._gg=function(l,u,o,h,a,c,s){var f=l+(u&h|o&~h)+(a>>>0)+s;return(f<<c|f>>>32-c)+u},i._hh=function(l,u,o,h,a,c,s){var f=l+(u^o^h)+(a>>>0)+s;return(f<<c|f>>>32-c)+u},i._ii=function(l,u,o,h,a,c,s){var f=l+(o^(u|~h))+(a>>>0)+s;return(f<<c|f>>>32-c)+u},i._blocksize=16,i._digestsize=16,hr.exports=function(l,u){if(l==null)throw new Error("Illegal argument "+l);var o=n.wordsToBytes(i(l,u));return u&&u.asBytes?o:u&&u.asString?e.bytesToString(o):n.bytesToHex(o)}})()});var dr={};P(dr,{checkAuth:()=>Er,checkTrust:()=>Ir,easyAuth:()=>Rr});var pr,Rr,Er,Ir,gr=S(()=>{"use strict";pr=q(),Rr=(n,t,r)=>{},Er=(n,t,r)=>{let e={list:null,anchor:null};return t.auth?typeof t.auth=="string"||Array.isArray(t.auth)?e.anchor=t.auth:e.list=t.auth:t.salt&&(e.anchor=pr(n+t.salt[0])),r&&r(e)},Ir=(n,t,r)=>{let e={list:null,anchor:null};return t.trust?typeof t.trust=="string"||Array.isArray(t.trust)?e.anchor=t.trust:e.list=t.trust:t.salt&&(e.anchor=pr(n+t.salt[0])),r&&r(e)}});var vr={};P(vr,{checkHide:()=>Br,easyHide:()=>Pr});var Sr,Pr,Br,yr=S(()=>{"use strict";Sr=q(),Pr=n=>{},Br=(n,t,r)=>{let e={list:null,anchor:null};return t.hide?typeof t.hide=="string"?e.anchor=t.hide:Array.isArray(t.hide)&&(e.list=t.hide):t.salt&&(e.anchor=Sr(n+t.salt[1])),r&&r(e)}});var xr=C(U=>{var W=null,X=null,L={getLibs:(n,t,r,e)=>{r||(r={}),e||(e=[]);let i=n.shift(),l=(Array.isArray(i)?i[0]:i).toLocaleLowerCase(),u=Array.isArray(i)?i[1]:0;if(r[l])return L.getLibs(n,t,r,e);L.getAnchor(l,u,(o,h)=>{if(r[o]=h||{error:"no such anchor"},!h.protocol||!h.protocol.ext&&!h.protocol.lib)e.push(o);else{let a={entry:o,lib:h.protocol&&h.protocol.lib?h.protocol.lib:[],ext:h.protocol&&h.protocol.ext?h.protocol.ext:[]};e.push(a)}if(h.protocol&&h.protocol.ext)for(let a=h.protocol.ext.length;a>0;a--)n.unshift(h.protocol.ext[a-1]);if(h.protocol&&h.protocol.lib)for(let a=h.protocol.lib.length;a>0;a--)n.unshift(h.protocol.lib[a-1]);if(n.length===0)return t&&t(r,e);L.getLibs(n,t,r,e)})},getAnchor:(n,t,r)=>{if(!n)return r&&r(n,"");(t===0?W:X)(n,i=>{if(!i||!i.owner)return r&&r(n,"");if(!i.empty)return r&&r(n,i)})},decodeLib:n=>{let t={type:"error",data:""};if(n.error)return t.error=n.error,t;if(!n.protocol)return t.error="Unexcept data format",t;let r=n.protocol;return r.fmt?(t.type=r.fmt,n.raw.substr(0,2).toLowerCase()==="0x"?t.data=L.decodeUTF8(n.raw):t.data=n.raw,t):(t.error="Anchor format lost",t)},decodeUTF8:n=>{n.substr(0,2).toLowerCase()==="0x"&&(n=tr.slice(2));let t=n.replace(/\s+/g,"").split(""),r="";for(let e=0;e<t.length;e+=2)r+="%"+t[e]+t[e+1];return decodeURIComponent(r)},getComplexOrder:(n,t,r,e)=>{if(r||(r=[]),e||(e=[]),t[n]===!0&&e.length===0)return r;let i=t[n],l=e.length!==0?e[e.length-1]:null,u=l!==null&&l.name===n?e.pop():null;if(i.lib&&i.lib.length>0){if(u===null)for(let o=0;o<i.lib.length;o++){let h=i.lib[o];if(t[h]===!0)r.push(h);else return e.push({lib:o,name:n}),L.getComplexOrder(h,t,r,e)}else if(u.lib!==void 0&&u.lib!==i.lib.length)for(let o=u.lib+1;o<i.lib.length;o++){let h=i.lib[o];if(t[h]===!0)r.push(h);else return e.push({lib:o,name:n}),L.getComplexOrder(h,t,r,e)}}if(u===null&&r.push(n),i.ext&&i.ext.length>0)if(u!==null){if(u.ext!==void 0&&u.ext!==i.ext.length)for(let o=u.ext+1;o<i.ext.length;o++){let h=i.ext[o];if(t[h]===!0)r.push(h);else return e.push({ext:o,name:n}),L.getComplexOrder(h,t,r,e)}}else for(let o=0;o<i.ext.length;o++){let h=i.ext[o];if(t[h]===!0)r.push(h);else return e.push({ext:o,name:n}),L.getComplexOrder(h,t,r,e)}if(e.length!==0){let o=e[e.length-1];return L.getComplexOrder(o.name,t,r,e)}return r},mergeOrder:n=>{let t={},r={},e={},i=[];for(let l=0;l<n.length;l++){let u=n[l];typeof u!="string"&&u.entry!==void 0?(t[u.entry]=!0,r[u.entry]=u):r[u]=!0}for(let l=0;l<n.length;l++){let u=n[l];if(typeof u=="string"||u instanceof String){if(e[u])continue;i.push(u),e[u]=!0}else{if(u.lib&&u.lib.length>0)for(let o=0;o<u.lib.length;o++){let h=u.lib[o];if(!e[h])if(t[h]){let a=L.getComplexOrder(h,r);for(let c=0;c<a.length;c++){let s=a[c];e[s]||(i.push(s),e[s]=!0)}}else i.push(h),e[h]=!0}if(e[u.entry]||(i.push(u.entry),e[u.entry]=!0),u.ext&&u.ext.length>0)for(let o=0;o<u.ext.length;o++){let h=u.ext[o];if(!e[h])if(t[h]){let a=L.getComplexOrder(h,r);for(let c=0;c<a.length;c++){let s=a[c];e[s]||(i.push(s),e[s]=!0)}}else i.push(h),e[h]=!0}}}return i},regroupCode:(n,t)=>{let r=L.decodeLib,e="",i="",l={},u={},o=!1,h=L.mergeOrder(t);for(let a=0;a<h.length;a++){let c=h[a];if(l[c])continue;let s=n[c],f=r(s);if(l[c]=!0,f.error){u[c]=f.error,o=!0;continue}e+=f.type==="js"?f.data:"",i+=f.type==="css"?f.data:""}return{js:e,css:i,failed:u,order:h,error:o}}};U.Loader=(n,t,r)=>{W=t.search,X=t.target,L.getLibs(n,r)};U.Group=L.regroupCode;U.Libs=(n,t,r)=>{W=t.search,X=t.target,L.getLibs(n,(e,i)=>{let l=L.regroupCode(e,i);return r&&r(l)})}});var Jr=C(H=>{Object.defineProperty(H,"__esModule",{value:!0});H.easyRun=void 0;var b=($(),E(J)),A=($(),E(J)),D=(ar(),E(or)),mr=(gr(),E(dr)),Ur=(yr(),E(vr)),Ar=xr(),br=Ar.Group,Dr=Ar.Loader,m=null,T={disable:!1,cache:!0,search:[],start:0,end:0,stamp:function(){return new Date().getTime()}},z={process:null},R={data:{},set:function(n,t,r){return R.data["".concat(n,"_").concat(t)]=r,!0},get:function(n,t){return R.data["".concat(n,"_").concat(t)]},clear:function(){R.data={}}},g={getAnchor:function(n,t){if(m===null)return t&&t({error:"No API to get data.",level:b.errorLevel.ERROR});var r=n[0],e=n[1];if(!T.cache){var i=R.get(r,e);if(i!==void 0)return t&&t(i)}e!==0?m.common.target(r,e,function(l){g.filterAnchor(l,t)}):m.common.latest(r,function(l){g.filterAnchor(l,t)})},filterAnchor:function(n,t){if(!n)return t&&t({error:"No such anchor.",level:b.errorLevel.ERROR});var r=n;if(r.error)return t&&t({error:r.error,level:b.errorLevel.ERROR});var e=n;if(T.disable||T.search.push([e.name,e.block]),T.cache||R.set(e.name,e.block,e),e.empty)return t&&t({error:"Empty anchor.",level:b.errorLevel.ERROR});if(!e.protocol)return t&&t({error:"No-protocol anchor."});var i=e.protocol;return i.type?t&&t(e):t&&t({error:"Not EasyProtocol anchor."})},decodeData:function(n,t){n.type=b.rawType.DATA;var r=n.data["".concat(n.location[0],"_").concat(n.location[1])],e=r.protocol;return e!==null&&e.call&&(n.call=e.call),t&&t(n)},decodeApp:function(n,t){n.type=b.rawType.APP;var r=n.data["".concat(n.location[0],"_").concat(n.location[1])],e=r.protocol;if(n.code=r.raw,e!==null&&e.res&&(n.resource=e.res),e!==null&&e.lib)g.getLibs(e.lib,function(i,l){var u=br(i,l),o={};for(var h in i){var a=i[h];a.name!==void 0&&(n.data["".concat(a.name,"_").concat(a.block)]=a,o[a.name]=[a.name,a.block])}if(u.order.length!==0){for(var c=[],s=0;s<u.order.length;s++){var f=u.order[s];o[f]!==void 0&&c.push(o[f])}u.order=c}return n.libs=u,t&&t(n)});else return t&&t(n)},decodeLib:function(n,t){n.type=b.rawType.LIB;var r=n.data["".concat(n.location[0],"_").concat(n.location[1])],e=r.protocol;if(e!==null&&e.lib)g.getLibs(e.lib,function(i,l){var u=br(i,l),o={};for(var h in i){var a=i[h];a.name!==void 0&&(n.data["".concat(a.name,"_").concat(a.block)]=a,o[a.name]=[a.name,a.block])}if(u.order.length!==0){for(var c=[],s=0;s<u.order.length;s++){var f=u.order[s];o[f]!==void 0&&c.push(o[f])}u.order=c}return n.libs=u,t&&t(n)});else return t&&t(n)},formatLibs:function(){},getLibs:function(n,t){if(m===null)return t&&t({error:"No API to get data.",level:b.errorLevel.ERROR});var r={search:m.common.latest,target:m.common.target};Dr(n,r,t)},getHistory:function(n,t){var r=[],e=[];if(m===null)return e.push({error:"No API to get data.",level:b.errorLevel.ERROR}),t&&t(r,e);var i=n[0],l=n[1];m.common.history(i,function(u){var o=u;if(o.error)return e.push(o),t&&t(r,e);var h=u;return h.length===0?(e.push({error:"Empty history"}),t&&t(r,e)):t&&t(h,e)})},merge:function(n,t,r){if(m===null)return r&&r({error:"No API to get data.",level:b.errorLevel.ERROR});var e={hide:[],auth:null,trust:null,error:[],index:[null,null,null],map:{}};g.singleRule(n,t,A.relatedIndex.HIDE,function(i,l,u,o){var h;u!==null&&(e.index[A.relatedIndex.HIDE]=u);for(var a in l)e.map[a]=l[a];o.length!==0&&(h=e.error).push.apply(h,o),e.hide=i,g.singleRule(n,t,A.relatedIndex.AUTH,function(c,s,f,p){var d;f!==null&&(e.index[A.relatedIndex.AUTH]=f);for(var x in s)e.map[x]=s[x];p.length!==0&&(d=e.error).push.apply(d,p),e.auth=c,g.singleRule(n,t,A.relatedIndex.TRUST,function(v,y,N,O){var w;N!==null&&(e.index[A.relatedIndex.TRUST]=N);for(var _ in y)e.map[_]=y[_];return O.length!==0&&(w=e.error).push.apply(w,O),e.trust=v,r&&r(e)})})})},singleRule:function(n,t,r,e){var i=null,l={},u=null,o=[];switch(r){case A.relatedIndex.HIDE:(0,Ur.checkHide)(n,t,function(h){if(h.anchor===null&&h.list!==null)return i=h.list,e&&e(i,l,u,o);if(h.anchor!==null&&h.list===null)g.singleExtend(h.anchor,!1,function(a,c,s){i=a;for(var f in c)l[f]=c[f];return o.push.apply(o,s),e&&e(i,l,u,o)});else return h.anchor!==null&&h.list!==null&&o.push({error:"Format error."}),e&&e(i,l,u,o)});break;case A.relatedIndex.AUTH:(0,mr.checkAuth)(n,t,function(h){if(h.anchor===null&&h.list!==null)return i=h.list,e&&e(i,l,u,o);if(h.anchor!==null&&h.list===null)g.singleExtend(h.anchor,!0,function(a,c,s){i=a;for(var f in c)l[f]=c[f];return o.push.apply(o,s),e&&e(i,l,u,o)});else return h.anchor!==null&&h.list!==null&&o.push({error:"Format error."}),e&&e(i,l,u,o)});break;case A.relatedIndex.TRUST:(0,mr.checkTrust)(n,t,function(h){if(h.anchor===null&&h.list!==null)return i=h.list,e&&e(i,l,u,o);if(h.anchor!==null&&h.list===null)g.singleExtend(h.anchor,!0,function(a,c,s){i=a;for(var f in c)l[f]=c[f];return o.push.apply(o,s),e&&e(i,l,u,o)});else return h.anchor!==null&&h.list!==null&&o.push({error:"Format error."}),e&&e(i,l,u,o)});break;default:o.push({error:"unknow related index."}),e&&e(i,l,u,o);break}},singleExtend:function(n,t,r){var e=null,i={},l=[],u=Array.isArray(n)?[n[0],0]:[n,0];t?g.getLatestDeclaredHidden(u,function(o,h){var a=o;a!==void 0&&a.error&&l.push(a),h!==void 0&&(i["".concat(h.name,"_").concat(h.block)]=h);var c=o,s={};if(Array.isArray(c))for(var f=0;f<c.length;f++)s[c[f]]=!0;g.getHistory([Array.isArray(n)?n[0]:n,0],function(p,d){d!==void 0&&l.push.apply(l,d);for(var x=0;x<p.length;x++){var v=p[x];if(i["".concat(v.name,"_").concat(v.block)]=v,!s[v.block]){if(!v.protocol||!v.raw||v.protocol.type!==b.rawType.DATA){l.push({error:"Not valid anchor. ".concat(v.name,":").concat(v.block)});continue}try{var y=JSON.parse(v.raw);e===null&&(e={});for(var N in y)e[N]=y[N]}catch{l.push({error:"JSON format failed. ".concat(v.name,":").concat(v.block)});continue}}}return r&&r(e,i,l)})}):g.getAnchor(Array.isArray(n)?n:[n,0],function(o){var h=o;if(h!==void 0&&h.error)return l.push(h),r&&r(e,i,l);var a=o;if(i["".concat(a.name,"_").concat(a.block)]=a,!a.protocol||!a.raw||a.protocol.type!==b.rawType.DATA)return l.push({error:"Not valid anchor."}),r&&r(e,i,l);try{return e=JSON.parse(a.raw),r&&r(e,i,l)}catch(c){return l.push({error:JSON.stringify(c)}),r&&r(e,i,l)}})},decodeHideAnchor:function(n){var t=[],r=n.protocol;if(r?.fmt==="json")try{var e=JSON.parse(n.raw);if(Array.isArray(e))for(var i=0;i<e.length;i++){var l=parseInt(e[i]);isNaN(l)||t.push(l)}}catch{return{error:"failed to parse JSON"}}return t},checkAuthority:function(n,t,r){if(t.type!==b.rawType.APP)return n.error.push({error:"Answer is not cApp."}),r&&r(n);var e=n.data["".concat(n.location[0],"_").concat(n.location[1])],i=e.signer,l=t.auth;if(l===void 0)return n.app=t,r&&r(n);if(g.empty(l))return n.app=t,r&&r(n);if(l[i]===void 0)return n.error.push({error:"No authority of caller."}),r&&r(n);if(l[i]===0)return n.app=t,r&&r(n);m?.common.block(function(u,o){return u>l[i]?(n.error.push({error:"Authority out of time."}),r&&r(n)):(n.app=t,r&&r(n))})},getLatestDeclaredHidden:function(n,t){g.getAnchor([n[0],0],function(r){var e=r;if(e.error)return t&&t([]);var i=r,l=i.protocol;if(l===null||!l.hide)return t&&t([]);if(Array.isArray(l.hide))return t&&t(l.hide);g.getAnchor([l.hide,0],function(u){var o=r;if(o.error)return t&&t([]);var h=u;if(h===null||!h.raw)return t&&t([],h);try{var a=JSON.parse(h.raw);return t&&t(a,h)}catch(c){return t&&t({error:c})}})})},isValidAnchor:function(n,t,r,e){var i=[],l=t.block,u=!1;if(Array.isArray(n)){for(var o=n,h=0;h<o.length;h++)if(l===o[h]){if(t.pre===0)return i.push({error:"Out of ".concat(t.name," limited")}),u=!0,r&&r(null,i,u);var a=(0,D.linkCreator)([t.name,t.pre],e);return r&&r(a,i,u)}return r&&r(null,i)}else{var c=[n,0];g.getAnchor(c,function(s){var f=g.decodeHideAnchor(s),p=f;p.error&&i.push(p);for(var d=f,x=0;x<d.length;x++)if(l===d[x]){if(t.pre===0)return i.push({error:"Out of ".concat(t.name," limited")}),u=!0,r&&r(null,i,u);var v=(0,D.linkCreator)([t.name,t.pre],e);return r&&r(v,i,u)}return r&&r(null,i,u)})}},export:function(n){return z.process!==null?z.process(n):!0},getParams:function(n){for(var t={},r=n.split("&"),e=0;e<r.length;e++){var i=r[e],l=i.split("=");if(l.length!==2)return{error:"error parameter"};t[l[0]]=l[1]}return t},empty:function(n){for(var t in n)return!1;return!0}},I={};I[b.rawType.APP]=g.decodeApp;I[b.rawType.DATA]=g.decodeData;I[b.rawType.LIB]=g.decodeLib;var F=function(n,t,r,e,i){m===null&&t!==null&&(m=t),t!==null&&t.agent!==void 0&&t.agent.process!==void 0&&(z.process=t.agent.process);var l=(0,D.linkDecoder)(n);if(l.error)return r&&r(l);if(e===void 0&&g.export("Ready to decode Anchor linker: ".concat(n)),e===void 0)return g.export("Try to check declared hidden."),g.getLatestDeclaredHidden(l.location,function(o,h){var a={type:b.rawType.NONE,location:[l.location[0],l.location[1]!==0?l.location[1]:0],error:[],data:{},index:[null,null,null]},c=o;if(c!==void 0&&c.error)return g.export("Failed to get declared hidden Anchor data."),a.error.push(c),F(n,m,r,[]);var s=o;return g.export("Get the declared hidden."),F(n,m,r,s)});var u={type:b.rawType.NONE,location:[l.location[0],l.location[1]!==0?l.location[1]:0],error:[],data:{},index:[null,null,null],hide:e};l.param&&(u.parameter=l.param),g.export("Try to get target Anchor data."),g.getAnchor(l.location,function(o){var h=o;if(h.error)return u.error.push(h),g.export("Failed to get target Anchor."),r&&r(u);var a=o;if(u.location[1]===0&&(u.location[1]=a.block),u.data["".concat(u.location[0],"_").concat(u.location[1])]=a,a.protocol===null)return u.error.push({error:"No valid protocol"}),r&&r(u);var c=a.protocol.type?a.protocol.type:"";if(!I[c])return u.error.push({error:"Not easy protocol type"}),r&&r(u);if(g.export("Checking validity of Anchor data."),a.protocol)g.isValidAnchor(e,a,function(p,d,x){var v;return(v=u.error).push.apply(v,d),x?r&&r(u):p!==null?F(p,m,r,e):(g.export("Valid Anchor data."),f(c))},u.parameter===void 0?{}:u.parameter);else return f(c);function s(p,d,x){if(g.export("Checking calling of Anchor."),p.call&&!x){var v=(0,D.linkCreator)(p.call,p.parameter===void 0?{}:p.parameter);return g.export("Call Anchor: ".concat(p.call)),F(v,m,function(y){return g.checkAuthority(p,y,d)},e,!0)}else return d&&d(p)}function f(p){g.export("Anchor type: ".concat(p," , ready to decode.")),g.merge(a.name,a.protocol,function(d){var x;g.export("Anchor data merged."),d.auth!==null&&(u.auth=d.auth),d.trust!==null&&(u.trust=d.trust),d.hide!=null&&d.hide.length!==0&&(u.hide=d.hide),d.error.length!==0&&(x=u.error).push.apply(x,d.error),d.index[A.relatedIndex.AUTH]!==null&&u.index&&(u.index[A.relatedIndex.AUTH]=d.index[A.relatedIndex.AUTH]),d.index[A.relatedIndex.HIDE]!==null&&u.index&&(u.index[A.relatedIndex.HIDE]=d.index[A.relatedIndex.HIDE]),d.index[A.relatedIndex.TRUST]!==null&&u.index&&(u.index[A.relatedIndex.TRUST]=d.index[A.relatedIndex.TRUST]);for(var v in d.map)u.data[v]=d.map[v];return g.export("Anchor data grouped."),I[p](u,function(y){if(g.export("Anchor data decoded."),y.resource)g.export("Need to load resource listed by Anchor ".concat(y.resource)),g.getAnchor([y.resource,0],function(N){var O=N;if(O.error)return u.error.push(O),g.export("Failed to load resource Anchor ".concat(y.resource)),s(y,r,i);var w=N;if(y.data["".concat(w.name,"_").concat(w.block)]=w,w.raw!==null){g.export("Loading resource Anchor list ".concat(w.raw));var _=JSON.parse(w.raw);_.length>2&&g.export("May take a bit long time, too much resource to load."),m!==null&&m.common.multi!==void 0&&m.common.multi(_,function(K){var Z=K;if(Z.error)return u.error.push(Z),r&&r(y);var Lr=K;return y.raw=Lr,g.export("Resource loaded."),s(y,r,i)})}});else return s(y,r,i)})})}})},Hr=function(n,t,r){T.search=[],T.start=T.stamp(),F(n,t,function(e){return T.disable||(e.debug=T),T.end=T.stamp(),R.clear(),r&&r(e)})},Mr=T.disable?F:Hr;H.easyRun=Mr});Jr();})();
//!important This is the Typescript implement of Esay Protocol version 1.0.
//!important Easy Protocol is a simple protocol to launch cApp via Anchor network.
//!important All functions implement, but this implement only support JS with CSS application 
//!important this is not part of easy protocol, develop can limit the function freely
//!important This is the library for decoding anchor link
//!important 3 format of anchor linker. The "/" is optional.
//!important `anchor://${anchor}/${block}[/]`;
//!important `anchor://${anchor}[/]`;
//!important `anchor://${anchor}/${block}[/]?${key_1}=${value_1}&${key_2}=${value_2}`;
//!important This is the library for creating auth data
//!important This is the library for Esay Protocol v1.0
//!important All data come from `Anchor Link`
//!important This implement extend `auth` and `hide` by salt way to load data
//!important, as support `declared hidden`, this function may redirect many times, be careful.
/*! Bundled license information:

is-buffer/index.js:
  (*!
   * Determine if an object is a Buffer
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)
*/
