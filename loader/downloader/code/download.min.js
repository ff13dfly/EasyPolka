(()=>{var f={error:"\x1B[36m%s\x1B[0m",success:"\x1B[36m%s\x1B[0m",anchor:"plinth",server:"ws://127.0.0.1:9944",version:"1.0.2",step:300},p=LP,m=p.ApiPromise,b=p.WsProvider,s=LA,g=LE.easyRun,h=null,i={auto:(t,o)=>{if(h!==null)return o&&o();$("#output").html("Linked to websocket."),m.create({provider:new b(t)}).then(e=>(h=e,s.set(e),o&&o()))},stamp:()=>new Date().toLocaleString(),getServer:()=>f.server,clear:()=>{$("#output").html(""),$("#list").html("")},easyAnchor:(t,o)=>{let e={common:{latest:s.latest,target:s.target,history:s.history,owner:s.owner,subcribe:s.subcribe,multi:s.multi,block:s.block}};g(t,e,o)},decodeHash:t=>{let o={anchor:"",server:""};if(!t||t.length===1)return o;let e=t.split("@");return e.length>2||(e.length===2&&(o.server=e[1],o.anchor=e[0].substring(1)),e.length===1&&(o.anchor=e[0].substring(1))),o},groupResource:t=>{let o={},e={},r={};for(let c=0;c<t.length;c++){let n=t[c];if(n.raw!==null)try{let l=JSON.parse(n.raw);for(var a in l){o[a]=l[a];let u=a.split("_");u.length===2?(e[u[0]]||(e[u[0]]=[]),e[u[0]].push(parseInt(u[1])),r[u[0]]=n.name):e[a]=n.name}}catch(l){console.log(l)}}let d={};for(let c in e)if(!Array.isArray(e[c]))d[`${e[c]}|${c}`]=o[c];else{let n="";for(let l=0;l<e[c].length;l++)n+=o[`${c}_${l}`];d[`${r[c]}|${c}`]=n}return d},groupEasyData:t=>{let o={code:"",title:"",name:"",css:""};if(o.name=t.location[0],t.libs&&t.libs.css&&(o.css+=t.libs.css),t.libs&&t.libs.js&&(o.code+=t.libs.js),t.code&&(o.code+=t.code),t.resource&&t.raw){let r=i.groupResource(t.raw);for(var e in r)o.code=o.code.replaceAll(`anchor://${e}`,r[e])}return o},getReactTemplate:(t,o,e,r)=>`<!doctype html><html lang="en">
            <head>
                <meta charset="utf-8"/>
                <link rel="icon" href="./favicon.ico"/>
                <meta name="viewport" content="width=device-width,initial-scale=1"/>
                <meta name="theme-color" content="#000000"/>
                <meta name="description" content="Web application ${t} from Anchor Network"/>
                <title>${o}</title>
                <style>${r}</style>
            </head>
            <body>
                <noscript>You need to enable JavaScript to run this app.</noscript>
                <div id="root"></div>
            </body>
            <script>${e}<\/script>
        </html>`,downloadData:t=>{let o=document.createElement("a"),e="data:text/plain;charset=utf-8,",r=t.data[`${t.location[0]}_${t.location[1]}`];switch(t.type){case"app":let a=i.groupEasyData(t),d=i.getReactTemplate(a.name,a.title,a.code,a.css);o.setAttribute("href",e+encodeURIComponent(d)),o.setAttribute("download",`${t.location[0]}_${t.location[1]}_v${r.protocol.ver}.html`);break;case"data":let c={raw:r.raw,protocol:r.protocol},n=r.protocol.fmt?r.protocol.fmt:"json";o.setAttribute("href",e+encodeURIComponent(JSON.stringify(c))),o.setAttribute("download",`${t.location[0]}_${t.location[1]}.${n}`);break;case"lib":let l=adata.protocol.fmt?adata.protocol.fmt:"json";o.setAttribute("href",e+encodeURIComponent(r.raw)),o.setAttribute("download",`${t.location[0]}_${t.location[1]}_v${r.protocol.ver}.${l}`);break;default:o.setAttribute("href",e+encodeURIComponent(JSON.stringify(r))),o.setAttribute("download",`${t.location[0]}_${t.location[1]}.txt`);break}o.click()},getHistory:(t,o)=>{s.history(t,e=>{if(e===!1)return o&&o(e);let r="<ul>",a="down_row";for(let c=0;c<e.length;c++){let n=e[c],l=n.raw.length<500?`<tr>
                    <td>Raw Data</td>
                    <td>${n.raw}</td>
                </tr>`:"";r+=`<li>
                    [${n.protocol.type}] <a href="#${n.name}" class="${a}" data="anchor://${n.name}/${n.block}">
                        anchor://${n.name}/${n.block}
                    </a>
                    <table class="details">
                        <tr>
                            <td>Date</td>
                            <td>${new Date(n.stamp).toLocaleString()}</td>
                        </tr>
                        <tr>
                            <td>Signer</td>
                            <td>${n.signer}</td>
                        </tr>
                        <tr>
                            <td>Row length</td>
                            <td>${n.raw.length.toLocaleString()} bytes</td>
                        </tr>
                        ${l}
                        <tr>
                            <td>Protocol</td>
                            <td>${JSON.stringify(n.protocol)}</td>
                        </tr>
                    </table>
                    <p></p>
                </li>`}r+="</ul>",o&&o({dom:r,fun:function(){$(`.${a}`).off("click").on("click",function(){let c=$(this).attr("data");i.easyAnchor(c,n=>{i.downloadData(n)})})}})})}};$(()=>{$("#btn_search").off("click").on("click",()=>{i.clear();let e=$("#anchor_name").val();if(!e)return $("#output").html("Please input the anchor name.");$("#btn_search").prop("disabled",!0),i.auto(o,()=>{i.getHistory(e,r=>{if($("#btn_search").prop("disabled",!1),r===!1)return $("#output").html(`No such anchor : ${e}`);r.dom&&$("#list").html(r.dom),r.fun&&r.fun()})})}),$("#anchor_name").off("keyup").on("keyup",e=>{e.keyCode===13&&$("#btn_search").trigger("click")});let t=i.decodeHash(location.hash),o=t.server?t.server:i.getServer();$("#server").html(o),t.anchor&&($("#anchor_name").val(t.anchor),$("#btn_search").trigger("click"))});})();
//!important, This is the loader of launcher such as `Plinth`.
//!important, Need to build, the index.html not support hight version JS
